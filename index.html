<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Website Security Surface Scan | Urban Sentinel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    body{font-family:system-ui;background:#0f1115;color:#e6e6e6;padding:40px;margin:0}
    h1{margin-bottom:8px} h2{margin-top:22px} h3{margin-top:18px}
    p{max-width:1200px;line-height:1.6;color:#b6bcc8}
    .box{background:#141821;padding:24px;border-radius:10px;max-width:1200px;margin-top:30px}
    input{padding:12px;width:260px;border-radius:6px;border:1px solid #2a3140;background:#0f1115;color:#e6e6e6}
    button{padding:12px 18px;margin-left:10px;border-radius:6px;border:none;cursor:pointer;background:#3b82f6;color:white}
    button.secondary{background:#1f2937;margin-top:10px} button.hidden{display:none}
    pre{margin-top:12px;background:#0b0e14;padding:18px;border-radius:8px;white-space:pre-wrap;line-height:1.5;color:#cbd5f5}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    iframe{width:100%;height:600px;border:1px solid #2a3140;border-radius:8px;margin-top:20px;background:white}
    .muted{color:#8b92a8}
  </style>
</head>

<body>

<h1>AI-Assisted Website Security Surface Scan</h1>
<p>
Non-intrusive advisory assessment using <strong>publicly observable HTTP response headers</strong> and
<strong>static analysis of publicly served HTML</strong> only. Findings describe configuration and dependency
signals, not confirmed vulnerabilities or privacy breaches.
</p>

<div class="box">
  <label>Website domain</label><br /><br />
  <input id="domain" placeholder="example.com" />
  <button onclick="runScan()">Run AI surface scan</button>

  <h2>Results</h2>
  <div class="grid">
    <div>
      <h3>Plain English Summary</h3>
      <pre id="plainResults">Awaiting input…</pre>
    </div>
    <div>
      <h3>Technical Findings</h3>
      <pre id="techResults">Awaiting input…</pre>
    </div>
  </div>

  <button id="genPdfBtn" class="secondary hidden" onclick="generatePDF()">Generate advisory report (PDF)</button>
  <button id="dlPdfBtn" class="secondary hidden" onclick="downloadPDF()">Download PDF</button>
  <iframe id="pdfPreview" class="hidden"></iframe>
</div>

<script>
let reportDomain="", plainText="", techText="", pdfBlobUrl=null;

/* ---------- Helpers: header posture ---------- */
function classifyCSP(v){ if(!v) return "MISSING"; if(/default-src\s+\*/i.test(v)) return "WEAK"; return "STRONG"; }
function classifyHSTS(v){ if(!v) return "MISSING"; if(!/max-age=\d+/i.test(v)) return "WEAK"; return "STRONG"; }

/* ---------- Helpers: third-party detection ---------- */
const KNOWN_THIRD_PARTIES = [
  {name:"Google Analytics", match:/google-analytics\.com|gtag\/js/i},
  {name:"Google Tag Manager", match:/googletagmanager\.com/i},
  {name:"Google Ads / DoubleClick", match:/doubleclick\.net|googlesyndication\.com/i},
  {name:"Meta / Facebook", match:/connect\.facebook\.net|facebook\.net/i},
  {name:"Hotjar", match:/static\.hotjar\.com/i},
  {name:"Cloudflare", match:/cdnjs\.cloudflare\.com/i},
  {name:"Google Fonts", match:/fonts\.googleapis\.com|fonts\.gstatic\.com/i}
];

function extractExternalSources(html){
  const srcs=[...html.matchAll(/<(script|iframe|img|link)[^>]+?(src|href)=["']([^"']+)["']/gi)]
    .map(m=>m[3])
    .filter(u=>/^https?:\/\//i.test(u));
  return Array.from(new Set(srcs));
}

function detectThirdParties(html){
  const hits=[];
  KNOWN_THIRD_PARTIES.forEach(tp=>{
    if(tp.match.test(html)) hits.push(tp.name);
  });
  return Array.from(new Set(hits));
}

/* ---------- Main scan ---------- */
async function runScan(){
  const d=document.getElementById("domain").value.trim();
  const p=document.getElementById("plainResults");
  const t=document.getElementById("techResults");
  const gen=document.getElementById("genPdfBtn");
  const dl=document.getElementById("dlPdfBtn");
  const prev=document.getElementById("pdfPreview");
  gen.classList.add("hidden"); dl.classList.add("hidden"); prev.classList.add("hidden");

  if(!d){p.textContent="Please enter a domain.";t.textContent="—";return;}
  const url=d.startsWith("http")?d:"https://"+d;
  p.textContent="Running surface checks…";
  t.textContent="Collecting headers and static HTML…";

  try{
    /* Headers */
    const r=await fetch("https://api.allorigins.win/raw?url="+encodeURIComponent(url));
    const h=r.headers;

    const httpsStrong=url.startsWith("https://");
    const hstsState=classifyHSTS(h.get("Strict-Transport-Security"));
    const cspState=classifyCSP(h.get("Content-Security-Policy"));
    const clickStrong=!!h.get("X-Frame-Options") || (h.get("Content-Security-Policy")||"").includes("frame-ancestors");
    const mimeStrong=!!h.get("X-Content-Type-Options");
    const refStrong=!!h.get("Referrer-Policy");
    const permStrong=!!h.get("Permissions-Policy");

    /* HTML (static) */
    const html = await r.text();
    const thirdParties = detectThirdParties(html);
    const externals = extractExternalSources(html);

    /* Build findings */
    const findings=[
      ["HTTPS Transport", httpsStrong?"STRONG":"WEAK", httpsStrong?
        "Site is delivered over encrypted connections.":
        "Site is reachable without enforced encryption."],
      ["HSTS", hstsState, hstsState==="STRONG"?
        "Browsers are instructed to always use HTTPS.":
        hstsState==="WEAK"?"HSTS present but not fully configured.":
        "No instruction to enforce HTTPS."],
      ["Content Security Policy", cspState, cspState==="STRONG"?
        "Policy restricts how content may load.":
        cspState==="WEAK"?"Policy present but permissive.":
        "No policy limiting content sources."],
      ["Clickjacking Protection", clickStrong?"STRONG":"MISSING",
        clickStrong?"Embedding protections detected.":"Pages may be embedded by other sites."],
      ["MIME Sniffing Protection", mimeStrong?"STRONG":"MISSING",
        mimeStrong?"Browsers instructed not to guess file types.":"Browsers may attempt to guess file types."],
      ["Referrer Policy", refStrong?"STRONG":"MISSING",
        refStrong?"Limits referrer data exposure.":"Referrer data may be over-shared."],
      ["Permissions Policy", permStrong?"STRONG":"MISSING",
        permStrong?"Browser features explicitly controlled.":"Browser features not explicitly restricted."]
    ];

    let weak=0, missing=0;
    let plain="Summary of findings:\n\n";
    let tech="Technical observations:\n\n";

    findings.forEach(f=>{
      if(f[1]==="WEAK") weak++;
      if(f[1]==="MISSING") missing++;
      plain+=`${f[1]==="STRONG"?"✔":"⚠"} ${f[0]}: ${f[2]}\n`;
      tech+=`${f[1]} – ${f[0]}\n`;
    });

    /* Third-party section (surface indicators only) */
    plain+="\nThird-party & external dependencies:\n";
    if(thirdParties.length){
      plain+=`• This site references known third-party services (${thirdParties.join(", ")}). These are surface indicators of external dependencies, not proof of tracking or data misuse.\n`;
    } else {
      plain+="• No common advertising or analytics providers were detected via static HTML analysis.\n";
    }
    if(externals.length){
      plain+=`• External resources are loaded from ${externals.length} distinct URLs, indicating reliance on off-domain services for content or functionality.\n`;
    } else {
      plain+="• No external resource URLs were detected in static HTML.\n";
    }

    tech+="\nThird-party & external dependencies (static analysis):\n";
    tech+= thirdParties.length
      ? `• Detected references to: ${thirdParties.join(", ")}.\n`
      : "• No matches against the known third-party list.\n";
    tech+= externals.length
      ? `• External resource URLs detected (${externals.length}):\n   ${externals.slice(0,10).join("\n   ")}${externals.length>10?"\n   …":""}\n`
      : "• No external resource URLs detected.\n";

    const risk=(missing>=4||weak>=3)?"MODERATE":"LOW";
    plain+=`\nOverall surface posture: ${risk}\n\n`;
    plain+="Interpretation:\n- Findings reflect configuration and dependency signals.\n- Indicators do not confirm tracking, breaches, or compromise.\n";
    tech+=`\nOverall posture: ${risk}\n\n`;
    tech+="Notes:\n- Headers and HTML fetched via public HTTP response.\n- No script execution, crawling, or intrusive testing.\n";

    reportDomain=url.replace(/^https?:\/\//,"");
    plainText=plain; techText=tech;
    p.textContent=plain; t.textContent=tech;
    gen.classList.remove("hidden");

  }catch{
    p.textContent="Unable to retrieve headers or HTML (request blocked or network issue).";
    t.textContent="—";
  }
}

/* ---------- PDF ---------- */
function generatePDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  doc.text("Urban Sentinel",14,20);
  doc.text("AI-Assisted Website Security Surface Scan",14,30);
  doc.text(`Domain: ${reportDomain}`,14,40);
  doc.text(`Generated: ${new Date().toLocaleString()}`,14,46);
  doc.text("Plain English Summary",14,60);
  doc.text(plainText,14,66,{maxWidth:180});
  doc.addPage();
  doc.text("Technical Findings",14,20);
  doc.text(techText,14,26,{maxWidth:180});
  const blob=doc.output("blob");
  if(pdfBlobUrl)URL.revokeObjectURL(pdfBlobUrl);
  pdfBlobUrl=URL.createObjectURL(blob);
  const prev=document.getElementById("pdfPreview");
  prev.src=pdfBlobUrl; prev.classList.remove("hidden");
  document.getElementById("dlPdfBtn").classList.remove("hidden");
}
function downloadPDF(){
  const a=document.createElement("a");
  a.href=pdfBlobUrl;
  a.download=`urban-sentinel-ai-surface-scan-${reportDomain}.pdf`;
  a.click();
}
</script>

</body>
</html>
