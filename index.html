<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI-Assisted Website Security Surface Scan | Urban Sentinel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    body{
      font-family:system-ui;
      background:#0f1115;
      color:#e6e6e6;
      padding:40px;
      margin:0
    }
    h1{margin-bottom:8px}
    h2{margin-top:22px}
    h3{margin-top:18px}
    p{max-width:1200px;line-height:1.6;color:#b6bcc8}
    .box{
      background:#141821;
      padding:24px;
      border-radius:10px;
      max-width:1200px;
      margin-top:30px
    }
    input{
      padding:12px;
      width:260px;
      border-radius:6px;
      border:1px solid #2a3140;
      background:#0f1115;
      color:#e6e6e6
    }
    button{
      padding:12px 18px;
      margin-left:10px;
      border-radius:6px;
      border:none;
      cursor:pointer;
      background:#3b82f6;
      color:white
    }
    button.secondary{background:#1f2937;margin-top:10px}
    button.hidden{display:none}
    pre{
      margin-top:12px;
      background:#0b0e14;
      padding:18px;
      border-radius:8px;
      white-space:pre-wrap;
      line-height:1.5;
      color:#cbd5f5
    }
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:18px;
      margin-top:18px
    }
    /* Modal */
    #pdfModal{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.85);
      z-index:9999;
      align-items:center;
      justify-content:center
    }
    #pdfModal .inner{
      width:90%;
      height:90%;
      background:#111;
      border-radius:10px;
      display:flex;
      flex-direction:column
    }
    #pdfModal .header{
      padding:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:#141821;
      border-bottom:1px solid #2a3140
    }
    #pdfModal iframe{
      flex:1;
      border:none;
      background:#fff
    }
  </style>
</head>

<body>

<h1>AI-Assisted Website Security Surface Scan</h1>
<p>
Non-intrusive, AI-assisted surface assessment using
<strong>publicly observable HTTP response headers</strong> and
<strong>static analysis of publicly served HTML</strong> only.
No authentication, probing, exploitation, or bypass techniques are used.
</p>

<div class="box">
  <label>Website domain</label><br><br>
  <input id="domain" placeholder="example.com">
  <button onclick="runScan()">Run AI surface scan</button>

  <h2>Results</h2>
  <div class="grid">
    <div>
      <h3>Plain English Summary</h3>
      <pre id="plainResults">Awaiting input…</pre>
    </div>
    <div>
      <h3>Technical Findings</h3>
      <pre id="techResults">Awaiting input…</pre>
    </div>
  </div>

  <button id="genPdfBtn" class="secondary hidden" onclick="generatePDF()">
    Generate advisory report
  </button>
  <button id="dlPdfBtn" class="secondary hidden" onclick="downloadPDF()">
    Download PDF
  </button>
</div>

<!-- PDF MODAL -->
<div id="pdfModal">
  <div class="inner">
    <div class="header">
      <strong>Advisory Report Preview</strong>
      <button onclick="closePdfModal()">Close</button>
    </div>
    <iframe id="pdfPreview"></iframe>
  </div>
</div>

<script>
let reportDomain="",plainText="",techText="",pdfBlobUrl=null;

const THIRD_PARTIES=[
  {n:"Google Analytics",r:/google-analytics\.com|gtag\/js/i},
  {n:"Google Tag Manager",r:/googletagmanager\.com/i},
  {n:"Google Ads / DoubleClick",r:/doubleclick\.net|googlesyndication\.com/i},
  {n:"Meta / Facebook",r:/connect\.facebook\.net|facebook\.net/i},
  {n:"Hotjar",r:/hotjar/i},
  {n:"Google Fonts",r:/fonts\.googleapis\.com|fonts\.gstatic\.com/i}
];

function classifyCSP(v){
  if(!v) return "MISSING";
  if(/default-src\s+\*/i.test(v)) return "WEAK";
  return "STRONG";
}
function classifyHSTS(v){
  if(!v) return "MISSING";
  if(!/max-age=\d+/i.test(v)) return "WEAK";
  return "STRONG";
}

function extractExternal(html){
  return [...html.matchAll(/<(script|iframe|img|link)[^>]+?(src|href)=["']([^"']+)["']/gi)]
    .map(m=>m[3]).filter(u=>/^https?:\/\//i.test(u));
}
function detectThird(html){
  return THIRD_PARTIES.filter(t=>t.r.test(html)).map(t=>t.n);
}

async function runScan(){
  const d=document.getElementById("domain").value.trim();
  const p=document.getElementById("plainResults");
  const t=document.getElementById("techResults");
  const gen=document.getElementById("genPdfBtn");
  const dl=document.getElementById("dlPdfBtn");
  gen.classList.add("hidden"); dl.classList.add("hidden");

  if(!d){p.textContent="Please enter a domain.";t.textContent="—";return;}
  const url=d.startsWith("http")?d:"https://"+d;

  p.textContent="Running surface checks…";
  t.textContent="Collecting headers and HTML…";

  try{
    const r=await fetch("https://api.allorigins.win/raw?url="+encodeURIComponent(url));
    const h=r.headers;
    const html=await r.text();

    const findings=[
      ["HTTPS Transport",url.startsWith("https://")?"STRONG":"WEAK"],
      ["HSTS",classifyHSTS(h.get("Strict-Transport-Security"))],
      ["Content Security Policy",classifyCSP(h.get("Content-Security-Policy"))],
      ["Clickjacking Protection",(h.get("X-Frame-Options")||"").length?"STRONG":"MISSING"],
      ["MIME Sniffing Protection",h.get("X-Content-Type-Options")?"STRONG":"MISSING"],
      ["Referrer Policy",h.get("Referrer-Policy")?"STRONG":"MISSING"],
      ["Permissions Policy",h.get("Permissions-Policy")?"STRONG":"MISSING"]
    ];

    let weak=0,missing=0;
    plainText="Summary of findings:\n\n";
    techText="Technical observations:\n\n";

    findings.forEach(f=>{
      if(f[1]==="WEAK") weak++;
      if(f[1]==="MISSING") missing++;
      plainText+=`${f[1]==="STRONG"?"✔":"⚠"} ${f[0]}: ${f[1]}\n`;
      techText+=`${f[1]} – ${f[0]}\n`;
    });

    const third=detectThird(html);
    const external=extractExternal(html);

    plainText+="\nThird-party & external dependencies:\n";
    plainText+=third.length
      ? `• References detected to: ${third.join(", ")} (surface indicators only).\n`
      : "• No common advertising or analytics providers detected.\n";
    plainText+=external.length
      ? `• External resources loaded from ${external.length} URLs.\n`
      : "• No external resource URLs detected.\n";

    techText+="\nThird-party & external dependencies (static HTML):\n";
    techText+=third.length?`• ${third.join(", ")}\n`:"• None detected\n";
    techText+=external.length?`• External URLs: ${external.slice(0,8).join(", ")}\n`:"";

    const risk=(missing>=4||weak>=3)?"MODERATE":"LOW";
    plainText+=`\nOverall surface posture: ${risk}\n\n`;
    plainText+="Indicators do not confirm compromise, tracking, or privacy breach.\n";
    techText+=`\nOverall posture: ${risk}\n`;

    reportDomain=url.replace(/^https?:\/\//,"");
    p.textContent=plainText;
    t.textContent=techText;
    gen.classList.remove("hidden");

  }catch{
    p.textContent="Unable to retrieve headers or HTML.";
    t.textContent="—";
  }
}

function generatePDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  doc.text("Urban Sentinel",14,20);
  doc.text("AI-Assisted Website Security Surface Scan",14,30);
  doc.text(`Domain: ${reportDomain}`,14,40);
  doc.text(`Generated: ${new Date().toLocaleString()}`,14,46);
  doc.text("Plain English Summary",14,60);
  doc.text(plainText,14,66,{maxWidth:180});
  doc.addPage();
  doc.text("Technical Findings",14,20);
  doc.text(techText,14,26,{maxWidth:180});

  const blob=doc.output("blob");
  if(pdfBlobUrl)URL.revokeObjectURL(pdfBlobUrl);
  pdfBlobUrl=URL.createObjectURL(blob);

  document.getElementById("pdfPreview").src=pdfBlobUrl;
  document.getElementById("pdfModal").style.display="flex";
  document.getElementById("dlPdfBtn").classList.remove("hidden");
}

function closePdfModal(){
  document.getElementById("pdfModal").style.display="none";
}
function downloadPDF(){
  const a=document.createElement("a");
  a.href=pdfBlobUrl;
  a.download=`urban-sentinel-ai-surface-scan-${reportDomain}.pdf`;
  a.click();
}
</script>

</body>
</html>
