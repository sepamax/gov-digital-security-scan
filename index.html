<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI-Assisted Website Security Surface Scan | Urban Sentinel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:system-ui;background:#0f1115;color:#e6e6e6;padding:40px;margin:0}
h1{margin-top:0}
.box{background:#141821;padding:20px;border-radius:10px;max-width:1200px;margin-top:24px}
input{padding:12px;width:260px;border-radius:6px;border:1px solid #2a3140;background:#0f1115;color:#e6e6e6}
button{padding:12px 18px;margin-left:10px;border-radius:6px;border:none;cursor:pointer;background:#3b82f6;color:white;opacity:.4}
button.enabled{opacity:1}
button.secondary{background:#1f2937}
button.hidden{display:none}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
pre{background:#0b0e14;padding:14px;border-radius:8px;white-space:pre-wrap;line-height:1.5;color:#cbd5f5;min-height:90px}
.hidden{display:none}

/* animated dots */
.dots::after{content:"";display:inline-block;width:1em;animation:ellipsis 1.4s infinite}
@keyframes ellipsis{0%{content:""}25%{content:"."}50%{content:".."}75%{content:"..."}100%{content:""}}

/* indicators */
.indicators{border:2px solid #1f2937;background:#0b0e14}
.matrix-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #1f2937}
.matrix-row:last-child{border-bottom:none}
.pill{font-size:12px;padding:3px 10px;border-radius:999px;font-weight:600}
.ok{background:#064e3b;color:#6ee7b7}
.warn{background:#3f2f1d;color:#fcd34d}

/* glow CTA */
.glow{margin-left:14px;color:#93c5fd;animation:pulse 2s infinite}
@keyframes pulse{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}

/* modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:999}
.modal.active{display:flex}
.modal-content{background:#fff;width:90%;max-width:1100px;height:85vh;border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
.modal-header{background:#111827;color:#e5e7eb;padding:12px 16px;display:flex;justify-content:space-between}
.modal-body{flex:1}
.modal-body iframe{width:100%;height:100%;border:none}
</style>
</head>

<body>

<h1>AI-Assisted Website Security Surface Scan</h1>

<div class="box">
  <label>Website domain</label><br><br>
  <input id="domain" placeholder="e.g. yoursite.com" oninput="checkDomain()">
  <button id="scanBtn" disabled onclick="handleScan()">Run AI surface scan</button>
</div>

<!-- TOP RESULTS -->
<div id="indicatorBox" class="box indicators hidden">
  <h2>Surface Security Indicators</h2>
  <div id="matrixRows"></div>
</div>

<div class="box">
  <div class="grid">
    <div>
      <h3>Summary for Decision-Makers</h3>
      <pre id="plainResults">Awaiting input<span class="dots"></span></pre>
    </div>
    <div>
      <h3>Technical Findings</h3>
      <pre id="techResults">Awaiting input<span class="dots"></span></pre>
    </div>
  </div>

  <div style="margin-top:18px">
    <button id="genReportBtn" class="secondary hidden" onclick="openReportModal()">Generate advisory report</button>
    <span id="glowText" class="glow hidden">Generate full scan results to find out more â†’</span>
  </div>
</div>

<!-- REPORT MODAL -->
<div id="reportModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <strong>Advisory Report Preview</strong>
      <button onclick="closeReportModal()">Close</button>
    </div>
    <div class="modal-body">
      <iframe id="reportFrame"></iframe>
    </div>
  </div>
</div>

<script>
let scanned=false;

function validDomain(v){
  return /^[a-z0-9.-]+\.[a-z]{2,}$/i.test(v);
}

function checkDomain(){
  if(scanned) return;
  const v=domain.value.trim();
  scanBtn.disabled=!validDomain(v);
  scanBtn.classList.toggle("enabled",!scanBtn.disabled);
}

async function handleScan(){
  scanned ? resetScan() : await runScan();
}

async function runScan(){
  const d=domain.value.trim();
  if(!validDomain(d)) return;

  scanned=true;
  scanBtn.textContent="Refresh scan";
  scanBtn.classList.add("enabled");

  /* ===== RUN ALL 3 SCANS ===== */
  const scanResults = await runFullScan(d);

  /* store basics */
  sessionStorage.setItem("scanDomain",d);

  /* display indicators */
  matrixRows.innerHTML="";
  addRow("Edge / CDN Protection",scanResults.edgePosture);
  addRow("Geographic Exposure",scanResults.geoOrientation);
  addRow("Transport Security",scanResults.tlsPosture);
  indicatorBox.classList.remove("hidden");

  /* summary text */
  plainResults.textContent=
`This assessment reviews publicly observable security posture signals.

Edge protection, geographic exposure, and transport security were analysed
using automated surface inspection.

Results reflect configuration posture only.`;

  techResults.textContent=
`Edge: ${scanResults.edgePosture}
Geographic exposure: ${scanResults.geoOrientation}
TLS posture: ${scanResults.tlsPosture}`;

  sessionStorage.setItem("scanSummary",plainResults.textContent);

  genReportBtn.classList.remove("hidden");
  glowText.classList.remove("hidden");
}

function resetScan(){
  scanned=false;
  domain.value="";
  scanBtn.textContent="Run AI surface scan";
  scanBtn.disabled=true;
  scanBtn.classList.remove("enabled");
  indicatorBox.classList.add("hidden");
  genReportBtn.classList.add("hidden");
  glowText.classList.add("hidden");
  plainResults.innerHTML="Awaiting input<span class='dots'></span>";
  techResults.innerHTML="Awaiting input<span class='dots'></span>";
  sessionStorage.clear();
}

function addRow(label,value){
  const r=document.createElement("div");
  r.className="matrix-row";
  r.innerHTML=`<span>${label}</span><span class="pill ok">${value}</span>`;
  matrixRows.appendChild(r);
}

/* ===== FULL SCAN LOGIC ===== */
async function runFullScan(domain){
  const res={
    edgePosture:"EDGE_NOT_OBSERVED",
    geoOrientation:"MIXED_ORIENTATION",
    tlsPosture:"AGING_TLS"
  };

  /* EDGE / CDN */
  try{
    const r=await fetch(`https://${domain}`,{mode:"no-cors"});
    const h={};
    r.headers?.forEach((v,k)=>h[k.toLowerCase()]=v.toLowerCase());
    if(h["cf-ray"]||h["cf-cache-status"]||h["server"]?.includes("cloudflare")) res.edgePosture="EDGE_DETECTED";
  }catch{}

  /* GEO */
  if(domain.endsWith(".com.au")||domain.endsWith(".au")) res.geoOrientation="LOCAL_ONLY";
  if(domain.endsWith(".com")) res.geoOrientation="MIXED_ORIENTATION";

  /* TLS */
  try{
    const r=await fetch(`https://${domain}`,{cache:"no-store"});
    const exp=r.headers.get("expires");
    if(exp){
      const days=(new Date(exp)-new Date())/86400000;
      res.tlsPosture=days>30?"MODERN_TLS":"AGING_TLS";
    }else{
      res.tlsPosture="COMPATIBILITY_TLS";
    }
  }catch{}

  sessionStorage.setItem("edgePosture",res.edgePosture);
  sessionStorage.setItem("geoOrientation",res.geoOrientation);
  sessionStorage.setItem("tlsPosture",res.tlsPosture);

  return res;
}

/* ===== REPORT MODAL ===== */
function openReportModal(){
  reportFrame.src="report.html";
  reportModal.classList.add("active");
}
function closeReportModal(){
  reportModal.classList.remove("active");
  reportFrame.src="";
}
</script>

</body>
</html>
