<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Website Security Surface Scan | Urban Sentinel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: system-ui;
      background: #0f1115;
      color: #e6e6e6;
      padding: 40px;
    }
    .hidden { display: none; }
    pre {
      background:#111;
      padding:20px;
      white-space:pre-wrap;
    }
    button { padding:10px 16px; margin-right:10px; }
  </style>
</head>

<body>

<!-- ================= SCAN VIEW ================= -->
<section id="scanView">
  <h1>AI-Assisted Website Security Surface Scan</h1>
  <p>Non-intrusive advisory assessment using publicly observable HTTP response headers only.</p>

  <input id="domain" placeholder="example.com">
  <button onclick="runScan()">Run scan</button>

  <pre id="scanOutput">Awaiting input…</pre>

  <button id="viewBtn" class="hidden" onclick="showReportView()">
    View / Save report
  </button>
</section>

<!-- ================= REPORT VIEW ================= -->
<section id="reportView" class="hidden">
  <h1>Security Scan Report</h1>

  <p><strong>Domain:</strong> <span id="rDomain"></span></p>
  <p><strong>Generated:</strong> <span id="rTime"></span></p>

  <pre id="rContent"></pre>

  <button onclick="window.print()">Print / Save</button>
  <button onclick="backToScan()">Back to scan</button>
</section>

<script>
let reportText = "";
let reportDomain = "";

async function runScan() {
  const domainInput = document.getElementById("domain");
  const output = document.getElementById("scanOutput");
  const viewBtn = document.getElementById("viewBtn");

  let domain = domainInput.value.trim();
  if (!domain) {
    output.textContent = "Enter a domain.";
    return;
  }
  if (!domain.startsWith("http")) domain = "https://" + domain;

  output.textContent = "Running AI surface scan…";

  const response = await fetch(
    "https://api.allorigins.win/raw?url=" + encodeURIComponent(domain)
  );

  const headers = response.headers;
  const checks = [
    ["Strict-Transport-Security","HSTS"],
    ["Content-Security-Policy","CSP"],
    ["X-Frame-Options","X-Frame-Options"],
    ["X-Content-Type-Options","X-Content-Type-Options"],
    ["Referrer-Policy","Referrer-Policy"],
    ["Permissions-Policy","Permissions-Policy"]
  ];

  let missing = 0;
  let report = "AI-Assisted Header Assessment\n\n";

  checks.forEach(([h,label])=>{
    if(headers.get(h)) report += `✔ ${label}\n`;
    else { report += `⚠ ${label}\n`; missing++; }
  });

  report += `\nOverall surface risk: ${
    missing>=4?"HIGH":missing>=2?"MODERATE":"LOW"
  }\n`;

  reportText = report;
  reportDomain = domain.replace(/^https?:\/\//,"");

  output.textContent = report;
  viewBtn.classList.remove("hidden");
}

function showReportView() {
  document.getElementById("scanView").classList.add("hidden");
  document.getElementById("reportView").classList.remove("hidden");

  document.getElementById("rDomain").textContent = reportDomain;
  document.getElementById("rContent").textContent = reportText;
  document.getElementById("rTime").textContent = new Date().toLocaleString();
}

function backToScan() {
  document.getElementById("reportView").classList.add("hidden");
  document.getElementById("scanView").classList.remove("hidden");
}
</script>

</body>
</html>
